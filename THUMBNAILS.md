<!--
SPDX-FileCopyrightText: Â© 2024 David Bliss

SPDX-License-Identifier: GFDL-1.3-or-later
-->

# Thumbnails

Fotema generates thumbnails for all of your library's images and videos
so that albums can be quickly displayed and scrolled.

## XDG thumbnail specification

Since version 2.0.0, Fotema generates thumbnails in a format that is compliant with the
[XDG thumbnail specification](https://specifications.freedesktop.org/thumbnail-spec/latest/index.html#history).

However, Fotema __does not__ store thumbnails in the XDG thumbnail specification standard
location (`~/.cache/thumbnails`). This means thumbnails generated by Fotema
will not be useable by other applications, such as your file manager.

## Why non-compliance?

The XDG thumbnail directory is automatically cleaned up by your desktop environment.
By default the cleanup policy is quite aggressive and Fotema will frequently spend
much CPU and wall-clock time re-generating thumbnails, thereby defeating one of the
stated goals of the thumbnail specification.

This leads to a pretty poor experience without changing the thumbnail
cache [cleanup policies](https://davejansen.com/increase-thumbnail-cache-in-ubuntu/).

## Thumbnail size

Fotema generates thumbnails of the "large" size, which makes the longest edge of
the thumbnail 256 pixels. In my testing about 12,000 thumbnails takes a little over 1GB of storage.
Your mileage may vary.

## Using Fotema thumbnails for your system

If you want to use Fotema's thumbnails for your system, then you can symlink
your thumbnail cache to Fotema's thumbnail cache--but be aware that you will
probably lose thumbnails unless you reconfigure the thumbnail cache cleanup policies.

To use Fotema's thumbnail cache for your system:

```bash
rm -rf ~/.cache/thumbnails
ln -s ~/.var/app/app.fotema.Fotema/cache/app.fotema.Fotema/thumbnails ~/.cache/thumbnails
```

## Packaging for non-Flatpak systems

If you are packaging Fotema for a non-Flatpak system, then I suggest you keep
Fotema's thumbnails in their default location to give your users
the least surprising experience.

However, if you wish to cause Fotema to use the user's default thumbnail cache, then
you must patch the following files to change the thumbnail cache path:

* `app.rs`
* `bootstrap.rs`

Look for the lines with the comment "Remove to use standard XDG thumbnail path".
Example code:

```rust
let thumbnail_dir = glib::user_cache_dir()
    .join(APP_ID) // Remove to use standard XDG thumbnail path
    .join("thumbnails");
```

